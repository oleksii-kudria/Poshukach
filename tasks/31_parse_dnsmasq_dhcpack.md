# üß© –ó–∞–≤–¥–∞–Ω–Ω—è 31 ‚Äî –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ —Ñ–æ—Ä–º–∞—Ç—É dnsmasq `DHCPACK(...)` —É `payloadAsUTF`

## üéØ –ú–µ—Ç–∞
–î–æ–¥–∞—Ç–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫—É —â–µ –æ–¥–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç—É DHCP‚Äë–ª–æ–≥—ñ–≤ —É —Ñ–∞–π–ª–∞—Ö `data/raw/dhcp/*.csv`: —Ä—è–¥–∫–∏ –≤—ñ–¥ **dnsmasq-dhcp**, —è–∫—ñ –º—ñ—Å—Ç—è—Ç—å –ø–æ–¥—ñ—é **`DHCPACK(...)`**.

–ü–æ—Ç—Ä—ñ–±–Ω–æ –Ω–∞–≤—á–∏—Ç–∏—Å—è –≤–∏—Ç—è–≥—É–≤–∞—Ç–∏:
- `ip` (IPv4)
- `mac` (MAC‚Äë–∞–¥—Ä–µ—Å–∞)
- `name` (hostname), —è–∫—â–æ –ø—Ä–∏—Å—É—Ç–Ω—ñ–π

–§–æ—Ä–º–∞—Ç –º–∞—î –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ **—Ä–∞–∑–æ–º** –∑ —É–∂–µ –ø—ñ–¥—Ç—Ä–∏–º–∞–Ω–∏–º–∏ —Ñ–æ—Ä–º–∞—Ç–∞–º–∏ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π MikroTik, CEF, –ø—Ä–µ—Ñ—ñ–∫—Å–æ–≤–∞–Ω—ñ `dhcp,info <TAG>:`).

---

## üß© –ü—Ä–∏–∫–ª–∞–¥–∏ `payloadAsUTF`
```
<30>Dec 13 06:20:48 UDMD UDMD dnsmasq-dhcp[3888]: DHCPACK(br231) 192.168.77.92 e8:5a:8b:12:78:33 Redmi-99
<30>Dec 14 06:37:04 UDMD UDMD dnsmasq-dhcp[3896]: DHCPACK(br0) 192.168.2.200 60:22:32:21:22:19 NZsbh
<30>Dec 14 06:37:04 UDM-sec UDM-sec dnsmasq-dhcp[3896]: DHCPACK(br233) 192.168.111.200 60:22:32:21:22:19 NZsbh
<30>Dec 14 06:37:13 UDMD UDMD dnsmasq-dhcp[3896]: DHCPACK(br0) 192.168.2.154 84:78:48:c0:28:92 T1-UPS-2
```

–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ —Ä—è–¥–∫–∞:
- `ip = 192.168.2.154`
- `mac = 84:78:48:c0:28:92`
- `name = T1-UPS-2`

---

## ‚öôÔ∏è –ó–∞–≤–¥–∞–Ω–Ω—è

### 1) –î–µ—Ç–µ–∫—Ç–æ—Ä —Ñ–æ—Ä–º–∞—Ç—É dnsmasq
- –Ø–∫—â–æ `payloadAsUTF` –º—ñ—Å—Ç–∏—Ç—å –ø—ñ–¥—Ä—è–¥–æ–∫ `dnsmasq-dhcp` **—Ç–∞** `DHCPACK(` ‚Üí –≤–≤–∞–∂–∞—Ç–∏ —Ä—è–¥–æ–∫ —Ñ–æ—Ä–º–∞—Ç—É dnsmasq —ñ –∑–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –æ–∫—Ä–µ–º–∏–π –ø–∞—Ä—Å–µ—Ä.
- –¶–µ–π –¥–µ—Ç–µ–∫—Ç–æ—Ä –º–∞—î –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏—Å—è **–¥–æ** —Å–ø—Ä–æ–± –ø–∞—Ä—Å–∏—Ç–∏ —è–∫ MikroTik/–ø—Ä–µ—Ñ—ñ–∫—Å/—ñ–Ω—à–µ (—â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ —Ö–∏–±–Ω–∏—Ö ¬´–Ω–µ–º–æ–∂–ª–∏–≤–æ —Ä–æ–∑–ø–∞—Ä—Å–∏—Ç–∏¬ª).

### 2) –ü–∞—Ä—Å–∏–Ω–≥ dnsmasq DHCPACK
–í–∏—Ç—è–≥–Ω—É—Ç–∏ `ip`, `mac`, `name` –∑ —á–∞—Å—Ç–∏–Ω–∏ –ø—ñ—Å–ª—è `DHCPACK(<iface>)`.

–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∏–π regex (case-insensitive):
```regex
DHCPACK\([^)]*\)\s+(?P<ip>[0-9.]+)\s+(?P<mac>(?:[0-9A-Fa-f]{2}:){5}[0-9A-Fa-f]{2})(?:\s+(?P<name>\S.+))?$
```
–ü–æ—è—Å–Ω–µ–Ω–Ω—è:
- `ip` ‚Äî IPv4 –ø—ñ—Å–ª—è `DHCPACK(...)`
- `mac` ‚Äî MAC —É —Ñ–æ—Ä–º–∞—Ç—ñ `xx:xx:xx:xx:xx:xx`
- `name` ‚Äî –æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ, —É—Å–µ —â–æ –∑–∞–ª–∏—à–∏–ª–æ—Å—å –ø—ñ—Å–ª—è MAC (–ø–æ—Ç—Ä—ñ–±–Ω–æ `strip()`)

### 3) –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –ø–æ–ª—ñ–≤
- `mac` –ø—Ä–∏–≤–æ–¥–∏—Ç–∏ –¥–æ —Ñ–æ—Ä–º–∞—Ç—É `XX:XX:XX:XX:XX:XX` (–≤–µ—Ä—Ö–Ω—ñ–π —Ä–µ–≥—ñ—Å—Ç—Ä).
- `name`:
  - `strip()`
  - —è–∫—â–æ –ø–æ—Ä–æ–∂–Ω—î –∞–±–æ –≤–∏–≥–ª—è–¥–∞—î —è–∫ IP/MAC ‚Üí `unknown`
  - —ñ–Ω–∞–∫—à–µ ‚Äî –∑–∞–ø–∏—Å–∞—Ç–∏ —è–∫ —î (—Ä–µ–≥—ñ—Å—Ç—Ä –Ω–µ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –∞–±–æ –Ω–æ—Ä–º–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∑–∞ —á–∏–Ω–Ω–∏–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏ –ø—Ä–æ—î–∫—Ç—É).

### 4) –ü–æ–≤–µ–¥—ñ–Ω–∫–∞ –ø—Ä–∏ –≤—ñ–¥—Å—É—Ç–Ω–æ—Å—Ç—ñ `name`
–Ø–∫—â–æ –ø—ñ—Å–ª—è MAC –Ω–µ–º–∞—î —Ç–µ–∫—Å—Ç—É –∞–±–æ –≤—ñ–Ω –ø–æ—Ä–æ–∂–Ω—ñ–π ‚Üí `name = unknown`.

### 5) –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫
- –Ø–∫—â–æ –¥–µ—Ç–µ–∫—Ç–æ—Ä dnsmasq —Å–ø—Ä–∞—Ü—é–≤–∞–≤, –∞–ª–µ regex –Ω–µ –∑–Ω–∞–π—à–æ–≤ `ip/mac` ‚Äî –Ω–µ –∑—É–ø–∏–Ω—è—Ç–∏ –æ–±—Ä–æ–±–∫—É, –≤–∏–≤–µ—Å—Ç–∏ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è:
```
‚ö†Ô∏è –ù–µ–º–æ–∂–ª–∏–≤–æ —Ä–æ–∑–ø–∞—Ä—Å–∏—Ç–∏ dnsmasq DHCPACK —Ä—è–¥–æ–∫ payloadAsUTF: <–æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∞ —Å—Ç—Ä–æ–∫–∞>
```
(–°—Ç–∏–ª—å –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω—å —É–∑–≥–æ–¥–∏—Ç–∏ –∑ –ø–æ—Ç–æ—á–Ω–∏–º–∏.)

### 6) –ü—ñ–¥—Å—É–º–æ–∫ —É –∫–æ–Ω—Å–æ–ª—ñ (–∫–æ—Ä–æ—Ç–∫–æ)
–î–æ–¥–∞—Ç–∏ –æ–∫—Ä–µ–º–∏–π –ª—ñ—á–∏–ª—å–Ω–∏–∫ –æ–±—Ä–æ–±–ª–µ–Ω–∏—Ö dnsmasq‚Äë—Ä—è–¥–∫—ñ–≤ —ñ –ø—Ä–æ–ø—É—â–µ–Ω–∏—Ö/–Ω–µ—Ä–æ–∑–ø—ñ–∑–Ω–∞–Ω–∏—Ö dnsmasq‚Äë—Ä—è–¥–∫—ñ–≤:
```
‚úÖ DNSMASQ DHCPACK —Ä—è–¥–∫—ñ–≤ –æ–±—Ä–æ–±–ª–µ–Ω–æ: X
‚ö†Ô∏è DNSMASQ DHCPACK —Ä—è–¥–∫—ñ–≤ –ø—Ä–æ–ø—É—â–µ–Ω–æ: Y
```

---

## üß™ –¢–µ—Å—Ç–∏

### –ú–∞—î –ø–∞—Ä—Å–∏—Ç–∏—Å—è —É—Å–ø—ñ—à–Ω–æ
```
<30>Dec 14 06:37:13 UDMD UDMD dnsmasq-dhcp[3896]: DHCPACK(br0) 192.168.2.154 84:78:48:c0:28:92 T1-UPS-2
```
–û—á—ñ–∫—É–≤–∞–Ω–Ω—è:
- `ip = 192.168.2.154`
- `mac = 84:78:48:C0:28:92` (–ø—ñ—Å–ª—è –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—ó)
- `name = T1-UPS-2`

### –ú–∞—î –ø–∞—Ä—Å–∏—Ç–∏—Å—è –∑ `name=unknown`
```
<30>Dec 14 06:37:04 UDMD UDMD dnsmasq-dhcp[3896]: DHCPACK(br0) 192.168.2.200 60:22:32:21:22:19
```
–û—á—ñ–∫—É–≤–∞–Ω–Ω—è:
- `name = unknown`

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä—ñ—ó –ø—Ä–∏–π–Ω—è—Ç—Ç—è
- [ ] –†—è–¥–∫–∏ dnsmasq `DHCPACK(...)` –∫–æ—Ä–µ–∫—Ç–Ω–æ —Ä–æ–∑–ø—ñ–∑–Ω–∞—é—Ç—å—Å—è —Ç–∞ –ø–∞—Ä—Å—è—Ç—å—Å—è.
- [ ] `ip`, `mac`, `name` –≤–∏—Ç—è–≥—É—é—Ç—å—Å—è –∫–æ—Ä–µ–∫—Ç–Ω–æ; `mac` –Ω–æ—Ä–º–∞–ª—ñ–∑—É—î—Ç—å—Å—è –¥–æ –≤–µ—Ä—Ö–Ω—å–æ–≥–æ —Ä–µ–≥—ñ—Å—Ç—Ä—É.
- [ ] –§–æ—Ä–º–∞—Ç –Ω–µ –ª–∞–º–∞—î –æ–±—Ä–æ–±–∫—É —ñ–Ω—à–∏—Ö —Ç–∏–ø—ñ–≤ —Ä—è–¥–∫—ñ–≤ (MikroTik/CEF/–ø—Ä–µ—Ñ—ñ–∫—Å–∏).
- [ ] –î–æ–¥–∞–Ω–æ –∫–æ—Ä–æ—Ç–∫–∏–π –ø—ñ–¥—Å—É–º–æ–∫ —É –∫–æ–Ω—Å–æ–ª—å —â–æ–¥–æ dnsmasq‚Äë—Ä—è–¥–∫—ñ–≤.
