# üß© –ó–∞–≤–¥–∞–Ω–Ω—è 25 ‚Äî –§—ñ–∫—Å –ø–æ—Ä–æ–∂–Ω—å–æ–≥–æ `rds-network.csv` (device_network.yml –¥–ª—è RDS)

## üéØ –ú–µ—Ç–∞
–ó–∞–±–µ–∑–ø–µ—á–∏—Ç–∏ –∫–æ—Ä–µ–∫—Ç–Ω–µ —Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—è `data/result/rds-network.csv` –ø—ñ–¥ —á–∞—Å –∑–∞–ø—É—Å–∫—É:
```bash
python3 scripts/psh.py rds
```
–ù–∞—Ä–∞–∑—ñ —Ñ–∞–π–ª —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è, –∞–ª–µ **–ø–æ—Ä–æ–∂–Ω—ñ–π**, –ø–æ–ø—Ä–∏ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å —É `data/interim/rds.csv` –∑–∞–ø–∏—Å—ñ–≤ –∑ –≤–µ–Ω–¥–æ—Ä–∞–º–∏ –Ω–∞ –∫—à—Ç–∞–ª—Ç **"TP-Link Systems Inc"**, **"TP-LINK TECHNOLOGIES CO.,LTD."**, **"Routerboard.com"** —Ç–æ—â–æ.  
–ù–µ–æ–±—Ö—ñ–¥–Ω–æ:
1) –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ **–æ–∫—Ä–µ–º–∏–π –ø—Ä–æ—Ö—ñ–¥** –ø–æ `device_network.yml` —Å–∞–º–µ –¥–ª—è RDS;  
2) **–Ω–æ—Ä–º–∞–ª—ñ–∑—É–≤–∞—Ç–∏** –ø–æ–ª—è `vendor` —Ç–∞ **–ø—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ case-insensitive/regex** –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è;  
3) –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–æ–±–ª—è—Ç–∏ `require`/`except` (–Ω–µ –±–ª–æ–∫—É–≤–∞—Ç–∏ –≤—Å–µ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º).

---

## üîß –ó–∞–≤–¥–∞–Ω–Ω—è

### 1) –û–∫—Ä–µ–º–∏–π –ø—Ä–æ—Ö—ñ–¥ (–ü–æ—Ç—ñ–∫ B) –¥–ª—è RDS
- –ó–∞–±–µ–∑–ø–µ—á–∏—Ç–∏ –≤–∏–∫–ª–∏–∫ –ª–æ–≥—ñ–∫–∏ **–º–µ—Ä–µ–∂–µ–≤–∏—Ö –ø—Ä–∞–≤–∏–ª** –¥–ª—è `data/interim/rds.csv`, –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –ü–æ—Ç–æ–∫—É A (random ‚Üí ignore ‚Üí MAC).
- –ù–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –≤—ñ–¥—Ñ—ñ–ª—å—Ç—Ä–æ–≤–∞–Ω—É –ø—ñ–¥–º–Ω–æ–∂–∏–Ω—É –∑ –ü–æ—Ç–æ–∫—É A ‚Äî **–±—Ä–∞—Ç–∏ –ø–æ–≤–Ω–∏–π –Ω–∞–±—ñ—Ä** —Ä—è–¥–∫—ñ–≤ –∑ `data/interim/rds.csv`.
- –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø–∏—Å—É–≤–∞—Ç–∏ —É **`data/result/rds-network.csv`** –∑ —à–∞–ø–∫–æ—é —ñ–¥–µ–Ω—Ç–∏—á–Ω–æ—é –¥–æ `data/interim/rds.csv`.

### 2) –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –≤–µ–Ω–¥–æ—Ä–∞
- –ü–µ—Ä–µ–¥ –º–∞—Ç—á–∏–Ω–≥–æ–º –Ω–æ—Ä–º–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –æ–±–∏–¥–≤—ñ —á–∞—Å—Ç–∏–Ω–∏:
  - `vendor_norm = vendor.strip()` ‚Üí –∑–Ω—è—Ç–∏ –ø—Ä–æ–±—ñ–ª–∏ –Ω–∞ –∫—Ä–∞—è—Ö;
  - –ø—Ä–∏–±—Ä–∞—Ç–∏ —Ñ—ñ–Ω–∞–ª—å–Ω—ñ `[,.;]` —Ç–∞ –ø–æ–¥–≤–æ—î–Ω—ñ –ø—Ä–æ–±—ñ–ª–∏;
  - –ø—Ä–∏–≤–µ—Å—Ç–∏ –¥–æ –Ω–∏–∂–Ω—å–æ–≥–æ —Ä–µ–≥—ñ—Å—Ç—Ä—É (`lower()`).
- –î–ª—è `patterns` —ñ–∑ `device_network.yml` –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è **–±–µ–∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è —Ä–µ–≥—ñ—Å—Ç—Ä—É**:
  - —è–∫—â–æ –µ–ª–µ–º–µ–Ω—Ç –≤–∏–≥–ª—è–¥–∞—î —è–∫ –∑–≤–∏—á–∞–π–Ω–∏–π —Ç–µ–∫—Å—Ç ‚Üí `pattern_norm in vendor_norm`;
  - —è–∫—â–æ –µ–ª–µ–º–µ–Ω—Ç –∑–∞–¥–∞–Ω–∏–π —è–∫ regex ‚Üí `re.search(pattern, vendor, re.IGNORECASE)`.

### 3) –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ `require` / `except`
- –Ø–∫—â–æ **`except`** (–±—É–¥—å-—è–∫–∏–π –ø—ñ–¥–ø—É–Ω–∫—Ç) —Å–ø—Ä–∞—Ü—é–≤–∞–≤ ‚Üí **–ø—Ä–∞–≤–∏–ª–æ –Ω–µ –∑–∞—Å—Ç–æ—Å–æ–≤—É–≤–∞—Ç–∏**.
- –Ø–∫—â–æ **`require`** **–ø—Ä–∏—Å—É—Ç–Ω—ñ–π**, —Ç–æ **–º–∞—î —Å–ø—Ä–∞—Ü—é–≤–∞—Ç–∏ —Ö–æ—á–∞ –± –æ–¥–Ω–∞** —É–º–æ–≤–∞ –∑ –Ω—å–æ–≥–æ, —ñ–Ω–∞–∫—à–µ –ø—Ä–∞–≤–∏–ª–æ **–Ω–µ –∑–∞—Å—Ç–æ—Å–æ–≤—É–≤–∞—Ç–∏**.
- –Ø–∫—â–æ `require` **–≤—ñ–¥—Å—É—Ç–Ω—ñ–π** ‚Üí –∑–±–µ—Ä–µ–≥—Ç–∏ **—Å—Ç–∞—Ä—É –ø–æ–≤–µ–¥—ñ–Ω–∫—É** (–∑–±—ñ–≥ –ø–æ `vendor` –¥–æ—Å—Ç–∞—Ç–Ω—ñ–π).
- –í—Ä–∞—Ö—É–≤–∞—Ç–∏, —â–æ –¥–ª—è RDS —á–∞—Å—Ç–æ `name` –º–æ–∂–µ –±—É—Ç–∏ `unknown`, –∞ `vendorClass` –≤—ñ–¥—Å—É—Ç–Ω—ñ–π ‚Äî **–Ω–µ —Ä–æ–±–∏—Ç–∏ `require` –æ–±–æ–≤ º—è–∑–∫–æ–≤–∏–º** –¥–ª—è –≤—Å—ñ—Ö –ø—Ä–∞–≤–∏–ª.

### 4) –ë–∞–∑–æ–≤—ñ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –≤–µ–Ω–¥–æ—Ä—ñ–≤ (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è —É `configs/device_network.yml`)
–î–æ–¥–∞—Ç–∏/—É—Ç–æ—á–Ω–∏—Ç–∏ –∑–∞–ø–∏—Å–∏, —â–æ–± –≤–æ–Ω–∏ —Å–ø—Ä–∞—Ü—å–æ–≤—É–≤–∞–ª–∏ –±–µ–∑ `require` (–¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –±—Ä–µ–Ω–¥—ñ–≤), –∞–±–æ –¥–æ–¥–∞—Ç–∏ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ –Ω–∞–ø–∏—Å–∞–Ω–Ω—è/regex:
```yaml
rules:
  - mode: vendor
    patterns:
      - "Routerboard.com"
      - "(?i)^mikrotik"             # –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–µ –Ω–∞–π–º–µ–Ω—É–≤–∞–Ω–Ω—è
  - mode: vendor
    patterns:
      - "(?i)^tp[- ]?link"          # –ø–æ–∫—Ä–∏–≤–∞—î TP-Link Systems Inc / TP-LINK TECHNOLOGIES CO.,LTD.
    # –∑–∞ –ø–æ—Ç—Ä–µ–±–∏ –º–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ require/except –¥–ª—è –≤—ñ–¥—Å—ñ–∫–∞–Ω–Ω—è USB-–∞–¥–∞–ø—Ç–µ—Ä—ñ–≤
```
> **–í–∞–∂–ª–∏–≤–æ:** —è–∫—â–æ –¥–æ–¥–∞—î—à `require` –¥–ª—è TP-Link (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `name_contains: ["Archer", "Deco"]`), –ø–µ—Ä–µ–∫–æ–Ω–∞–π—Å—è, —â–æ –¥–ª—è RDS –≤—ñ–Ω **–º–æ–∂–µ —Å–ø—Ä–∞—Ü—é–≤–∞—Ç–∏**, –∞–±–æ –∑–∞–≤–µ–¥–∏ **–æ–∫—Ä–µ–º–µ** –ø—Ä–∞–≤–∏–ª–æ –±–µ–∑ `require`.

### 5) –õ–æ–≥–∏ –ø—ñ–¥—Å—É–º–∫—É (—É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é, –∫–æ—Ä–æ—Ç–∫—ñ)
–í—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –≤–∏–º–æ–≥ –ó–∞–≤–¥–∞–Ω–Ω—è 21 ‚Äî **–ª–∏—à–µ –ø—ñ–¥—Å—É–º–∫–∏**:
```
üîß –ü—ñ–¥—Å—É–º–æ–∫ –ø—Ä–∞–≤–∏–ª vendor (device_network.yml): –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ=X, –ø—Ä–æ–ø—É—â–µ–Ω–æ=Y (except=a, require=b)
‚úÖ –û–±—Ä–æ–±–∫—É –ø—Ä–∞–≤–∏–ª vendor –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ.
```

---

## üß™ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ / –¢–µ—Å—Ç–∏

1) **–°–∞–Ω—ñ—Ç—ñ-—Ç–µ—Å—Ç**
   - –î–æ–¥–∞—Ç–∏ —É `data/interim/rds.csv` —Ä—è–¥–æ–∫ –∑ `vendor="Routerboard.com"` ‚Üí –æ—á—ñ–∫—É—î–º–æ –ø–æ—Ç—Ä–∞–ø–ª—è–Ω–Ω—è —É `rds-network.csv`.
2) **TP-Link –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∏**
   - –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ `vendor="TP-Link Systems Inc"` —Ç–∞ `vendor="TP-LINK TECHNOLOGIES CO.,LTD."` ‚Üí –ø—Ä–∏ –±–∞–∑–æ–≤–æ–º—É –ø—Ä–∞–≤–∏–ª—ñ –±–µ–∑ `require` –º–∞—é—Ç—å –ø–æ—Ç—Ä–∞–ø–ª—è—Ç–∏ –≤ —Å—ñ—Ç–∫—É.
3) **–í–∏–∫–ª—é—á–µ–Ω–Ω—è (`except`)**
   - –Ø–∫—â–æ –¥–æ–¥–∞–Ω—ñ `except` –¥–ª—è USB-–∞–¥–∞–ø—Ç–µ—Ä—ñ–≤ (—á–µ—Ä–µ–∑ `oui_prefixes` –∞–±–æ `name_regex`: `DESKTOP-`), –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —â–æ –ü–ö –∑ –∞–¥–∞–ø—Ç–µ—Ä–æ–º **–Ω–µ** –ø–æ—Ç—Ä–∞–ø–ª—è—î —É `rds-network.csv`.
4) **–ù–µ–∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å –≤—ñ–¥ –ü–æ—Ç–æ–∫—É A**
   - –ù–∞–≤—ñ—Ç—å —è–∫—â–æ –∑–∞–ø–∏—Å –ø–æ—Ç—Ä–∞–ø–∏–≤ —É `rds-ignore.csv` –∞–±–æ `rds-random.csv`, –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —â–æ **–æ–∫—Ä–µ–º–∏–π** –ø—Ä–æ—Ö—ñ–¥ –¥–ª—è –º–µ—Ä–µ–∂–µ–≤–∏—Ö –ø—Ä–∞–≤–∏–ª –ø—Ä–∞—Ü—é—î –Ω–∞ **–ø–æ–≤–Ω–æ–º—É** –Ω–∞–±–æ—Ä—ñ –¥–∞–Ω–∏—Ö —ñ –∫–æ—Ä–µ–∫—Ç–Ω–æ –≤–∏–∑–Ω–∞—á–∞—î –º–µ—Ä–µ–∂–µ–≤–µ –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è (–∑–∞ –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–æ—é —Ç–≤–æ—î—ó —Å–∏—Å—Ç–µ–º–∏ ‚Äî –¥–æ–∑–≤–æ–ª–µ–Ω–æ –¥—É–±–ª—é–≤–∞–Ω–Ω—è —É `rds-network.csv` —è–∫ –æ–∫—Ä–µ–º–∏–π –∑–≤—ñ—Ç–Ω–∏–π –∑—Ä—ñ–∑).

---

## üìã –ö—Ä–∏—Ç–µ—Ä—ñ—ó –ø—Ä–∏–π–Ω—è—Ç—Ç—è
- [ ] `python3 scripts/psh.py rds` –≥–µ–Ω–µ—Ä—É—î **–Ω–µ–ø–æ—Ä–æ–∂–Ω—ñ–π** `data/result/rds-network.csv` (–∑–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏—Ö –≤–µ–Ω–¥–æ—Ä—ñ–≤).
- [ ] –ú–∞—Ç—á–∏–Ω–≥ `vendor` —î **case-insensitive** —ñ –ø—ñ–¥—Ç—Ä–∏–º—É—î **regex**.
- [ ] `require`/`except` –ø—Ä–∞—Ü—é—é—Ç—å –∑–≥—ñ–¥–Ω–æ –ª–æ–≥—ñ–∫–∏ –≤–∏—â–µ, –±–µ–∑ —Ç–æ—Ç–∞–ª—å–Ω–æ–≥–æ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Å—ñ–≤.
- [ ] –ü—Ä–æ—Ö—ñ–¥ –¥–ª—è `device_network.yml` –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è **–æ–∫—Ä–µ–º–æ** –≤—ñ–¥ –ü–æ—Ç–æ–∫—É A —ñ –ø–æ **–ø–æ–≤–Ω–æ–º—É** `data/interim/rds.csv`.
- [ ] –£ –∫–æ–Ω—Å–æ–ª—ñ –ø–æ–∫–∞–∑–∞–Ω–æ **—Å—Ç–∏—Å–ª–∏–π** —É–∫—Ä–∞—ó–Ω—Å—å–∫–∏–π –ø—ñ–¥—Å—É–º–æ–∫ –¥–ª—è –ø—Ä–∞–≤–∏–ª vendor.

---

## üß± –ü—ñ–¥–∫–∞–∑–∫–∏ –¥–æ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó (—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ñ—É–Ω–∫—Ü—ñ–π)
- `load_rules("configs/device_network.yml") -> List[Rule]`
- `apply_network_rules(rows, rules) -> (matched_rows, counters)`
- `normalize_vendor(v: str) -> str` ‚Äî –æ–±—Ä—ñ–∑–∞–Ω–Ω—è –ø—Ä–æ–±—ñ–ª—ñ–≤, –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è –∫—ñ–Ω—Ü–µ–≤–∏—Ö –∑–Ω–∞–∫—ñ–≤, `lower()`
- `match_vendor(vendor: str, patterns: List[str]) -> bool` ‚Äî –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ contains/regex (–æ–±–∏–¥–≤–∞ case-insensitive)
- `require_hit(row, require_cfg) -> bool` ‚Äî –±—É–¥—å-—è–∫–∏–π –ø—ñ–¥–ø—É–Ω–∫—Ç (name_contains/vendor_class*/oui_prefixes)
- `except_hit(row, except_cfg) -> bool` ‚Äî –±—É–¥—å-—è–∫–∏–π –ø—ñ–¥–ø—É–Ω–∫—Ç
- –ù–∞–ø—Ä–∏–∫—ñ–Ω—Ü—ñ: `write_csv("data/result/rds-network.csv", matched_rows)`
