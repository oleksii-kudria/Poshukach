# üß© –ó–∞–≤–¥–∞–Ω–Ω—è 28 ‚Äî –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥—É `payloadAsUTF` —É –¥–≤–æ—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö: —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π —Ç–∞ CEF

## üéØ –ú–µ—Ç–∞
–ó–∞–±–µ–∑–ø–µ—á–∏—Ç–∏ –∫–æ—Ä–µ–∫—Ç–Ω–∏–π —Ä–æ–∑–±—ñ—Ä –ø–æ–ª—è `payloadAsUTF` —É —Ñ–∞–π–ª–∞—Ö `data/raw/dhcp/*.csv` –¥–ª—è **–¥–≤–æ—Ö —Ñ–æ—Ä–º–∞—Ç—ñ–≤**:
1) **–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π MikroTik** (`dhcp,info <dhcpName> assigned <IP> (for|to) <MAC> [<NAME>]`)
2) **CEF** (—Ä—è–¥–æ–∫ –º—ñ—Å—Ç–∏—Ç—å `CEF:` —ñ –∫–ª—é—á—ñ —Ç–∏–ø—É `msg=...`), –¥–µ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ `msg` ‚Äî —Ç–æ–π —Å–∞–º–∏–π DHCP-—Ç–µ–∫—Å—Ç.

–°–∫—Ä–∏–ø—Ç –º–∞—î **–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∑–Ω–∞—á–∞—Ç–∏** —Ñ–æ—Ä–º–∞—Ç —Ä—è–¥–∫–∞ —ñ –ø–∞—Ä—Å–∏—Ç–∏ –æ–±–∏–¥–≤–∞ –≤–∞—Ä—ñ–∞–Ω—Ç–∏. –ù–∞–∑–≤–∞ DHCP‚Äë—Å–µ—Ä–≤–µ—Ä–∞ –º–æ–∂–µ –±—É—Ç–∏ **–±—É–¥—å‚Äë—è–∫–æ—é** (`dhcp1`, `defconf`, `dhcp2`, `LAN_dhcp`, —Ç–æ—â–æ).

---

## ‚ö†Ô∏è –ü—Ä–∏–∫–ª–∞–¥ –ø–æ–º–∏–ª–∫–∏
```
‚ö†Ô∏è –ù–µ–º–æ–∂–ª–∏–≤–æ —Ä–æ–∑–ø–∞—Ä—Å–∏—Ç–∏ —Ä—è–¥–æ–∫ payloadAsUTF: 2025-11-01T01:10:54.868+0200 1MB CEF:0|MikroTik|RB2011UAS|7.19.4 (stable)|16|dhcp,info|Low|dvchost=1MB dvc=10.10.10.225 msg=dhcp1 assigned 192.168.1.14 for AA:44:33:00:77:CC POCO
```

---

## üß© –ó–∞–≤–¥–∞–Ω–Ω—è

### 1) –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ñ–æ—Ä–º–∞—Ç—É
- –Ø–∫—â–æ `payloadAsUTF` **–º—ñ—Å—Ç–∏—Ç—å** –ø—ñ–¥—Ä—è–¥–æ–∫ `CEF:` ‚Üí **–ø–∞—Ä—Å–∏—Ç–∏ —è–∫ CEF**.
- –Ü–Ω–∞–∫—à–µ ‚Äî **–ø–∞—Ä—Å–∏—Ç–∏ —è–∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π** —Ñ–æ—Ä–º–∞—Ç.

### 2) –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç—É
–ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ –±—É–¥—å-—è–∫–µ —ñ–º‚Äô—è DHCP —Å–µ—Ä–≤–µ—Ä—É —Ç–∞ –æ–±–∏–¥–≤–∞ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ —Å–ø–æ–ª—É—á–Ω–∏–∫–∞:
```
^dhcp,info [^ ]+ assigned (?P<ip>[0-9.]+) (for|to) (?P<mac>[0-9A-F:]+)(?: (?P<name>.+))?$
```
- `ip` ‚Äî IPv4
- `mac` ‚Äî MAC —É —Ñ–æ—Ä–º–∞—Ç—ñ `XX:XX:XX:XX:XX:XX` (–≤–µ–ª–∏–∫–∏–º–∏ –ª—ñ—Ç–µ—Ä–∞–º–∏)
- `name` ‚Äî —è–∫—â–æ –ø—ñ—Å–ª—è MAC —î —Ç–µ–∫—Å—Ç (–º–æ–∂–µ –º—ñ—Å—Ç–∏—Ç–∏ –ø—Ä–æ–±—ñ–ª–∏) ‚Üí —Ü–µ —ñ–º'—è; —ñ–Ω–∞–∫—à–µ `unknown`

### 3) –ü–∞—Ä—Å–∏–Ω–≥ CEF
1. –°–ø–æ—á–∞—Ç–∫—É –≤–∏–¥—ñ–ª–∏—Ç–∏ **–∫–ª—é—á—ñ** `k=v` –∑ —á–∞—Å—Ç–∏–Ω–∏ –ø—ñ—Å–ª—è `CEF:...|severity|` (–∑–∞–∑–≤–∏—á–∞–π —Ü–µ `... key=value key=value ...`). –ù–∞—Å —Ü—ñ–∫–∞–≤–ª—è—Ç—å:
   - `msg` ‚Äî –º—ñ—Å—Ç–∏—Ç—å DHCP‚Äë—Ç–µ–∫—Å—Ç —É **—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º—É** –≤–∏–≥–ª—è–¥—ñ (`dhcp,info <dhcpName> assigned <IP> (for|to) <MAC> [<NAME>]`)
   - `dvc` (–∑–∞ –ø–æ—Ç—Ä–µ–±–∏ ‚Äî IP –¥–∂–µ—Ä–µ–ª–∞ –∂—É—Ä–Ω–∞–ª—É), `dvchost`/`dvchost` (—Ö–æ—Å—Ç), —Ç–æ—â–æ ‚Äî **–Ω–µ –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤—ñ**
2. –ù–∞ –∑–Ω–∞—á–µ–Ω–Ω—è `msg` **–ø–æ–≤—Ç–æ—Ä–Ω–æ** –∑–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ **—Ä–µ–≥—ñ—Å–∫‚Äë–∑ –Ω–µ–∑–∞–ª–µ–∂–Ω–∏–π** regex –∑—ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –ø—É–Ω–∫—Ç—É (–¥–∏–≤. –≤–∏—â–µ).  
3. –Ø–∫—â–æ `msg` –≤—ñ–¥—Å—É—Ç–Ω—î ‚Üí —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –≤–∏—Ä—ñ–∑–∞—Ç–∏ DHCP‚Äë—Ç–µ–∫—Å—Ç –ø—ñ—Å–ª—è `msg=` –∑—ñ –≤—Å—ñ—î—ó —Å—Ç—Ä–æ–∫–∏ (–¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ `key=`) —ñ –¥–∞–ª—ñ —Ä–æ–∑–ø–∞—Ä—Å–∏—Ç–∏ –∑–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–º regex.
4. –Ø–∫—â–æ –≤–∏–¥—ñ–ª–µ–Ω–æ `name` —ñ –≤–æ–Ω–æ –∑–±—ñ–≥–∞—î—Ç—å—Å—è –∑ `MAC`/`IP` ‚Üí –≤–≤–∞–∂–∞—Ç–∏ `name = unknown`.

### 4) –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è
- `mac` –ø—Ä–∏–≤–æ–¥–∏—Ç–∏ –¥–æ **–≤–µ—Ä—Ö–Ω—å–æ–≥–æ —Ä–µ–≥—ñ—Å—Ç—Ä—É** —Ç–∞ —Ñ–æ—Ä–º–∞—Ç—É `XX:XX:XX:XX:XX:XX` (–∑–∞–º—ñ–Ω–∏—Ç–∏ `-` –Ω–∞ `:` –ø—Ä–∏ –ø–æ—Ç—Ä–µ–±—ñ).
- `name`: –æ–±—Ä—ñ–∑–∞—Ç–∏ –ø—Ä–æ–±—ñ–ª–∏; —è–∫—â–æ —î –ª–∞–ø–∫–∏ ‚Äî –ø—Ä–∏–±—Ä–∞—Ç–∏ —ó—Ö. –Ø–∫—â–æ –ø–æ—Ä–æ–∂–Ω—î –∞–±–æ IP ‚Äî `unknown`.

### 5) –ü–æ–≤–µ–¥—ñ–Ω–∫–∞ –ø—Ä–∏ –ø–æ–º–∏–ª—Ü—ñ
- –Ø–∫—â–æ —Ä—è–¥–æ–∫ –Ω–µ –≤–¥–∞–ª–æ—Å—å —Ä–æ–∑–ø–∞—Ä—Å–∏—Ç–∏ –∞–Ω—ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–º, –∞–Ω—ñ CEF‚Äë—à–ª—è—Ö–æ–º ‚Äî **–Ω–µ –∑—É–ø–∏–Ω—è—Ç–∏** –æ–±—Ä–æ–±–∫—É.
- –í–∏–≤–µ—Å—Ç–∏ **–ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è** —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é:
  ```
  ‚ö†Ô∏è –ù–µ–º–æ–∂–ª–∏–≤–æ —Ä–æ–∑–ø–∞—Ä—Å–∏—Ç–∏ —Ä—è–¥–æ–∫ payloadAsUTF: <–æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∞ —Å—Ç—Ä–æ–∫–∞>
  ```

---

## üß™ –¢–µ—Å—Ç–æ–≤—ñ –ø—Ä–∏–∫–ª–∞–¥–∏ (–º–∞—é—Ç—å –ø–∞—Ä—Å–∏—Ç–∏—Å—è —É—Å–ø—ñ—à–Ω–æ)

**–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ:**
```
dhcp,info defconf assigned 192.168.88.243 to 4C:D5:77:7D:94:47
dhcp,info dhcp1 assigned 192.168.1.60 for EE:3C:E7:DA:8E:B4 Xiaomi-14T-Pro
dhcp,info LAN_dhcp assigned 10.10.0.100 for 12:34:56:78:9A:BC
```

**CEF (–∑ msg):**
```
2025-11-01T01:10:54.868+0200 1MB CEF:0|MikroTik|RB2011UAS|7.19.4 (stable)|16|dhcp,info|Low|dvchost=1MB dvc=10.10.10.225 msg=dhcp1 assigned 192.168.1.14 for AA:44:33:00:77:CC POCO
```

**–û—á—ñ–∫—É–≤–∞–Ω—ñ –ø–æ–ª—è –ø—ñ—Å–ª—è –ø–∞—Ä—Å–∏–Ω–≥—É:**
- `ip = 192.168.1.14`
- `mac = AA:44:33:00:77:CC`
- `name = POCO`

---

## üñ®Ô∏è –í–∏–≤—ñ–¥ —É –∫–æ–Ω—Å–æ–ª—å (–ø—Ä–∏–∫–ª–∞–¥)
```
‚úÖ DHCP-—Ä—è–¥–∫—ñ–≤ (—É—Å—ñ —Ñ–æ—Ä–º–∞—Ç–∏) –æ–±—Ä–æ–±–ª–µ–Ω–æ: 128
‚ö†Ô∏è –ü—Ä–æ–ø—É—â–µ–Ω–æ –Ω–µ—Ä–æ–∑–ø—ñ–∑–Ω–∞–Ω–∏—Ö —Ä—è–¥–∫—ñ–≤: 2
```

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä—ñ—ó –ø—Ä–∏–π–Ω—è—Ç—Ç—è
- [ ] –î–µ—Ç–µ–∫—Ç–æ—Ä —Ñ–æ—Ä–º–∞—Ç—É –∫–æ—Ä–µ–∫—Ç–Ω–æ —Ä–æ–∑—Ä—ñ–∑–Ω—è—î —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ —Ç–∞ CEF‚Äë—Ä—è–¥–∫–∏.
- [ ] –î–ª—è CEF —É—Å–ø—ñ—à–Ω–æ –ø–∞—Ä—Å–∏—Ç—å—Å—è `msg` —ñ –∑ –Ω—å–æ–≥–æ –≤–∏–¥—ñ–ª—è—é—Ç—å—Å—è `ip`, `mac`, `name`.
- [ ] –ù–∞–∑–≤–∞ DHCP‚Äë—Å–µ—Ä–≤–µ—Ä–∞ –≤ –æ–±–æ—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö –º–æ–∂–µ –±—É—Ç–∏ –±—É–¥—å-—è–∫–æ—é (–Ω–µ –≤–ø–ª–∏–≤–∞—î –Ω–∞ –ø–∞—Ä—Å–∏–Ω–≥).
- [ ] –°–∫—Ä–∏–ø—Ç –Ω–µ –∑–∞–≤–µ—Ä—à—É—î —Ä–æ–±–æ—Ç—É –ø—Ä–∏ –ø–æ–æ–¥–∏–Ω–æ–∫–∏—Ö –ø–æ–º–∏–ª–∫–∞—Ö –ø–∞—Ä—Å–∏–Ω–≥—É —ñ –ª–æ–≥—É—î –∑—Ä–æ–∑—É–º—ñ–ª—ñ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é.
